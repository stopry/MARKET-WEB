$(function(){
    function autoFooterHeader(){
        var winWidth = $(window).width();
        // var fwidth = $('.footer').width()|600;
        var fwidth = 600;
        var left = (winWidth-fwidth)/2;
        $(".header").css("left",left+'px');
        $(".footer").css("left",left+'px');
        $(".tipsArea").css("left",left+'px');
        $(".goldTotal").css("left",left+'px');
        $("#alertWeek").css("left",left+'px');
        $(".oprBtnWrap").css("left",left+'px');
        $(".dgtOrderBox").css("left",left+'px');
        $(".marketBuyBox").css("left",left+'px');
        $(".marketsaleBox").css("left",left+'px');
        $(".botOprArea").css("left",left+'px');
    }
    function setFont() {
       var _winW = $(window).width();
       if(_winW>640){
         $('html').css('font-size','60px');
       }
     }
     
     function setHF(){
         if(isPc()){
            setFont();
            $(window).resize(function () {
                setFont()
            });
            autoFooterHeader();
            $(window).resize(function(){
                autoFooterHeader();
            })
         }
     }
     setHF();
     _Z.ui.feedbtn('.feedbtn');
});
//判断是否是pc
function isPc() {
    var ua = window.navigator.userAgent.toLowerCase();//微信
    var u = navigator.userAgent;//手机类型android或ios
    if(ua.match(/MicroMessenger/i) == 'micromessenger'){//微信
        return false;
    }else if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) {//安卓手机
        return false;
    } else if (u.indexOf('iPhone') > -1) {//苹果手机
        return false;
    } else {
        return true;
    }
};
//显示提示信息
function showTips(msg,cla) {
    msg = msg || '空';
    cla = cla || '';
    var timer = null;
    $('#alertWeek').remove();
    var $alert = $('<div class="week-alert '+cla+'" id="alertWeek"></div>');
    $('body').append($alert);
    if(isPc()){
        var winWidth = $(window).width();
        var left = (winWidth-600)/2;
        $('#alertWeek').css('left',left+'px');
    }
    $alert.html(msg);
    $alert.addClass('alert-show');
    clearTimeout(timer);
    timer = setTimeout(function ()  {
            $alert.remove();
    }, 1900);
};
//显示关闭加载 TRUE显示 false关闭 默认打开
function showLoading(bool) {
    if(bool){
        $('#loadingToast').remove();
        var loading = $(
            "<div id=\"loadingToast\" style=\"opacity: 1; display: block;\">\n" +
            "    <div class=\"weui-mask_transparent\"></div>\n" +
            "    <div class=\"weui-toast\">\n" +
            "      <i class=\"weui-loading weui-icon_toast\"></i>\n" +
            "      <p class=\"weui-toast__content\">数据加载中</p>\n" +
            "    </div>\n" +
            "  </div>"
        );
        $('body').append(loading);
    }else{
        $('#loadingToast').remove();
    }
};
//显示遮罩层
function showLayer(bool) {
    $('.layerShadow').remove();
    if(bool){
        var $alert = $('<div class="layerShadow"></div>');
        $('body').append($alert);
    }else{
        $('.layerShadow').remove();
    }
};
//显示带背景色的遮罩层
function showLayerBlack(bool) {
    $('.layerShadow2').remove();
    if(bool){
        var $alert = $('<div class="layerShadow2"></div>');
        $('body').append($alert);
    }else{
        $('.layerShadow2').remove();
    }
};
//固定定位元素垂直居中
function objVerticalCenter(obj){
    var h = $(window).height();
    var w = $(window).width();
    var ow = $(obj).width();
    var oh = $(obj).height();
    var l = (w-ow)/2+'px';
    var t = (h-oh)/2+'px';
    $(obj).css({top:t,left:l});
};
//显示确认对话框的遮罩层
function showLayerDia(bool) {
    $('.layerShadow3').remove();
    if(bool){
        var $alert = $('<div class="layerShadow3"></div>');
        $('body').append($alert);
    }else{
        $('.layerShadow3').remove();
    }
};
//显示操作确认框
function showConDia(text,confirmFn,cancelFn){
    var body = $('body');
    showLayerDia(1);

    var confirDia =$(
        '<div class="confirmDia">'+
        '<div class="conHeader"><i class="closeThis feedbtn">×</i></div>'+
        '<div class="diaText">'+
        text+
        '</div>'+
        '<div class="btnWrap">'+
        '<div class="opBtn cancelBtn fl feedbtn">'+
        '取消'+
        '</div>'+
        '<div class="opBtn confimBtn fr feedbtn">'+
        '确定'+
        '</div>'+
        '</div>'+
        '</div>'
    );
    confirDia.css({
        height:'200px',
        top:($(window).height()-200)/2
    });
    body.append(confirDia);
    confirDia.find('.cancelBtn').click(function(){
        cancelFn();
        confirDia.remove();
        $('.confirmDia').remove();
        showLayerDia(!1);
    });
    confirDia.find('.confimBtn').click(function(){
        confirmFn();
        $('.confirmDia').remove();
        confirDia.remove();
        showLayerDia(!1);
    });
    //关闭
    confirDia.find('.closeThis').click(function(){
        $('.confirmDia').remove();
        confirDia.remove();
        showLayerDia(!1);
    });
};
//显示带输入框的确认框
function showConIpt(text,confirmFn,cancelFn){
    var body = $('body');
    showLayerDia(1);
    var confirDia =$(
        '<div class="confirmDia">'+
        '<div class="conHeader"><i class="closeThis feedbtn">×</i></div>'+
        '<div class="diaText">'+
        text+
        '</div>'+
        '<input type="password" placeholder="请输入交易密码" id="payPwd">'+
        '<div class="btnWrap">'+
        '<div class="opBtn cancelBtn fl feedbtn">'+
        '取消'+
        '</div>'+
        '<div class="opBtn confimBtn fr feedbtn">'+
        '确定'+
        '</div>'+
        '</div>'+
        '</div>'
    );
    confirDia.css({
        height:'200px',
        top:($(window).height()-200)/2
    });
    body.append(confirDia);
    confirDia.find('.cancelBtn').click(function(){
        cancelFn();
        confirDia.remove();
        showLayerDia(!1);
    });
    confirDia.find('.confimBtn').click(function(){
        var pwd = confirDia.find('#payPwd').val();
        if(!pwd){
            showTips('请输入交易密码','error');
            return;
        }
        confirmFn(pwd);
        confirDia.remove();
        showLayerDia(!1);
    });
    //关闭
    confirDia.find('.closeThis').click(function(){
        confirDia.remove();
        showLayerDia(!1);
    });
};



//下拉加载
function IndexLoad(){
    this.types = 0;//默认为推荐类型
    this.seltype = 0;//默认网游分类为综合
}
//页面到达底部
IndexLoad.prototype.pullBot = function(){
    var wh = $(window).height();
    var sct = $(window).scrollTop();
    var dh = $(document).height();
    if(wh+sct>dh-180){
        //到达底部
        return true;
    }
    //没有
    return false;
}
//加载数据
var isload = false;
var type0pgm = 1;//推荐
var type1pgm = 1;//礼包
var type2pgm = 1;//活动
//var type3pgm = 1;//活动
var types = 0;//大分类推荐
var seltype = 0;//推荐小分类综合
var searchconfig = {
    pagenum:type0pgm,//页数
    types:0,//默认为推荐类型
    seltype:0//默认网游分类为综合
}
//切换大分类
$('.tabBar li').click(function(){
    var index = $(this).index()
    types = index;
    if(types==0){
        searchconfig.pagenum = type0pgm
    }else if(types==1){
        searchconfig.pagenum = type1pgm
    }else{
        searchconfig.pagenum = type2pgm
    }
    if(types!=0){
        seltype = null;
    }
})

IndexLoad.prototype.getData = function(types,seltype,pgnum){
    var pgnum = pgnum||null;
    if(pgnum){
        type0pgm = 1;
    }
    var url = '#';
    var that = this;
    searchconfig.types = types;
    searchconfig.seltype = seltype;
    if(!isload){
        isload = true;
        $.ajax({
            url:url,
            type:'POST',
            data:searchconfig,
            success:function(datas){
                console.log('加载成功')
                if(types==0){
                    type0pgm++
                }else if(types==1){
                    type1pgm++
                }else{
                    type2pgm++
                }
                isload = false;
            },
            error:function(){
                console.log('加载成功')
            }
        })
    }
}
//实例化
var Load = new IndexLoad();
Load.getData(0,0);//推荐
Load.getData(1,null);//礼包
Load.getData(2,null);//活动
//切换网游分类小分类
$('.sortSelector div').click(function(){
    $(this).addClass('seled').siblings('div').removeClass('seled');
    var index = $(this).index();
    //log(index);
    seltype = index;
    Load.getData(types,seltype,1)
    log(searchconfig)
})

$(window).scroll(function(){
    var isbot = Load.pullBot();
    if(isbot){
        Load.getData(types,seltype);
    }
})
